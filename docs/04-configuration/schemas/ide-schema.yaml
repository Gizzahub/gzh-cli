# IDE Configuration Schema
# ========================
# Schema for gz ide command configuration files
# Version: 1.0.0

$schema: http://json-schema.org/draft-07/schema#
title: IDE Configuration Schema
description: Configuration schema for JetBrains IDE monitoring and management
type: object
required:
  - version

properties:
  version:
    type: string
    description: Schema version
    enum: ["1.0"]
    default: "1.0"

  # Monitoring settings
  monitoring:
    type: object
    properties:
      enabled:
        type: boolean
        description: Enable IDE monitoring
        default: true

      interval:
        type: string
        description: Check interval
        pattern: "^[0-9]+(s|m|h)$"
        default: "1s"

      startup_delay:
        type: string
        description: Delay before starting monitor
        pattern: "^[0-9]+(s|m|h)$"
        default: "5s"

      auto_fix:
        type: boolean
        description: Automatically fix sync issues
        default: false

      notify:
        type: boolean
        description: Send desktop notifications
        default: true

  # IDE configurations
  ides:
    type: object
    description: IDE-specific configurations
    properties:
      intellij:
        $ref: "#/definitions/ideConfig"

      goland:
        $ref: "#/definitions/ideConfig"

      pycharm:
        $ref: "#/definitions/ideConfig"

      webstorm:
        $ref: "#/definitions/ideConfig"

      phpstorm:
        $ref: "#/definitions/ideConfig"

      rubymine:
        $ref: "#/definitions/ideConfig"

      clion:
        $ref: "#/definitions/ideConfig"

      rider:
        $ref: "#/definitions/ideConfig"

      datagrip:
        $ref: "#/definitions/ideConfig"

      android_studio:
        $ref: "#/definitions/ideConfig"

      fleet:
        $ref: "#/definitions/ideConfig"

  # Path configurations
  paths:
    type: object
    properties:
      config_base:
        type: string
        description: Base directory for IDE configurations
        examples:
          - "$HOME/Library/Application Support/JetBrains"  # macOS
          - "$HOME/.config/JetBrains"                       # Linux
          - "%APPDATA%/JetBrains"                          # Windows

      custom_paths:
        type: object
        description: Custom paths for specific IDEs
        additionalProperties:
          type: string

  # Sync settings
  sync:
    type: object
    properties:
      enabled:
        type: boolean
        description: Enable settings sync monitoring
        default: true

      providers:
        type: array
        description: Sync providers to monitor
        items:
          type: string
          enum: ["jetbrains_account", "settings_repository", "cloud_config"]
        default: ["jetbrains_account"]

      check_conflicts:
        type: boolean
        description: Check for sync conflicts
        default: true

      auto_resolve:
        type: boolean
        description: Auto-resolve conflicts
        default: false

      conflict_strategy:
        type: string
        description: Conflict resolution strategy
        enum: ["local", "remote", "merge", "ask"]
        default: "ask"

  # File monitoring
  files:
    type: object
    properties:
      watch_patterns:
        type: array
        description: File patterns to monitor
        items:
          type: string
        default:
          - "*.xml"
          - "*.json"
          - ".idea/**"
          - "codestyles/*"
          - "options/*"

      ignore_patterns:
        type: array
        description: Patterns to ignore
        items:
          type: string
        default:
          - "*.log"
          - "*.tmp"
          - "tasks/*"
          - "workspace.xml"

      track_changes:
        type: boolean
        description: Track file changes
        default: true

  # Backup settings
  backup:
    type: object
    properties:
      enabled:
        type: boolean
        description: Enable automatic backups
        default: true

      directory:
        type: string
        description: Backup directory
        default: "$HOME/.config/gzh-manager/ide-backups"

      interval:
        type: string
        description: Backup interval
        pattern: "^[0-9]+(m|h|d)$"
        default: "1h"

      retention:
        type: string
        description: Backup retention period
        pattern: "^[0-9]+(d|w|m)$"
        default: "7d"

      compress:
        type: boolean
        description: Compress backups
        default: true

  # Logging
  logging:
    type: object
    properties:
      level:
        type: string
        enum: ["debug", "info", "warn", "error"]
        default: "info"

      file:
        type: string
        description: Log file path
        default: "$HOME/.config/gzh-manager/logs/ide-monitor.log"

      max_size:
        type: string
        description: Maximum log file size
        pattern: "^[0-9]+(K|M|G)$"
        default: "10M"

      rotate:
        type: boolean
        description: Enable log rotation
        default: true

  # Notifications
  notifications:
    type: object
    properties:
      desktop:
        type: boolean
        description: Enable desktop notifications
        default: true

      sound:
        type: boolean
        description: Play sound on notifications
        default: false

      webhook:
        type: object
        properties:
          enabled:
            type: boolean
            default: false

          url:
            type: string
            format: uri

          events:
            type: array
            items:
              type: string
              enum: ["sync_error", "config_change", "conflict_detected", "backup_complete"]

  # Hooks
  hooks:
    type: object
    properties:
      pre_fix:
        type: string
        description: Script to run before fixing issues

      post_fix:
        type: string
        description: Script to run after fixing issues

      on_change:
        type: string
        description: Script to run on configuration changes

      on_error:
        type: string
        description: Script to run on errors

definitions:
  ideConfig:
    type: object
    properties:
      enabled:
        type: boolean
        description: Monitor this IDE
        default: true

      path:
        type: string
        description: Custom configuration path

      version:
        type: string
        description: IDE version pattern to match
        examples: ["2023.*", "2024.1"]

      sync:
        type: object
        properties:
          enabled:
            type: boolean
            default: true

          provider:
            type: string
            enum: ["jetbrains_account", "settings_repository", "cloud_config"]

      monitor:
        type: object
        properties:
          config_files:
            type: boolean
            default: true

          plugins:
            type: boolean
            default: true

          projects:
            type: boolean
            default: false

      fix:
        type: object
        properties:
          auto:
            type: boolean
            default: false

          strategies:
            type: array
            items:
              type: string
              enum: ["restart_sync", "clear_cache", "reset_config", "reinstall_plugin"]

# Examples section
examples:
  - version: "1.0"
    monitoring:
      enabled: true
      interval: "1s"
      auto_fix: true
    ides:
      goland:
        enabled: true
        sync:
          enabled: true
          provider: "jetbrains_account"
      intellij:
        enabled: true
        sync:
          enabled: true
          provider: "settings_repository"
    backup:
      enabled: true
      interval: "30m"

  - version: "1.0"
    monitoring:
      enabled: true
      notify: true
    sync:
      enabled: true
      check_conflicts: true
      conflict_strategy: "local"
    notifications:
      desktop: true
      webhook:
        enabled: true
        url: "https://hooks.slack.com/services/xxx"
        events: ["sync_error", "conflict_detected"]
